# 知识库助手 v2.0

## 安全与系统边界说明（Safety & Guardrails）

本文档说明「知识库助手」在不同场景下的行为规则、安全约束与防误导设计。  
目标是让用户清楚了解：系统何时可以信任，何时需要谨慎，何时会主动拒绝回答。

---

## 1. 设计原则

知识库助手基于以下核心原则设计：

| 原则 | 说明 |
|------|------|
| **知识库优先** | 所有回答应尽可能基于当前知识库中的文档内容 |
| **诚实透明** | 当缺乏证据时，系统必须明确告知不确定性，而非编造内容 |
| **宁缺毋滥** | 系统不会在无知识库依据时给出误导性答案；宁可不答，也不误导 |
| **可追溯** | 每条回答的来源应可验证，用户可自行判断可信度 |
| **状态可见** | 系统当前状态（知识库是否为空、置信度高低）应清晰展示给用户 |

---

## 2. 知识库状态与系统行为

### 2.1 知识库为空

**定义**：当前未导入任何文档，或重新索引后文档数为 0。

**系统行为**：
- ❌ 禁止回答问题（输入框禁用）
- ❌ 禁用严格模式（自动补查功能）
- ❌ 禁用「保存为文档」功能
- ⚠️ 顶部状态栏显示「知识库为空」

**用户提示文案**：
> 当前知识库为空，无法基于文档回答问题。请先上传并索引文档。

**设计理由**：  
没有知识库时，系统无法提供有依据的回答。强制禁用问答功能，避免用户误以为系统能回答任意问题。

---

### 2.2 知识库存在，但检索无结果

**定义**：知识库中有文档，但针对当前问题未检索到任何相关文本块（所有相似度分数低于阈值）。

**系统行为**：
- ✅ 允许回答，但置信度标记为「待补充」（低可信）
- ❌ 不展示引用来源（因为没有有效来源）
- ⚠️ 回答中明确说明「未在知识库中找到相关内容」

**用户提示文案**：
> 证据不足提示：当前知识库可能缺少相关文档，建议检查问题是否清晰、补充与问题相关的文档、或尝试换一种方式提问。

**设计理由**：  
区分「系统无法工作」和「系统工作了但没找到答案」。后者仍可提供一定参考，但必须明确标注不确定性。

---

### 2.3 严格模式 / 自动补查失败

**定义**：用户启用了「严格模式」，系统已尝试自动再检索（最多 N 轮），但仍未获得有效证据。

**系统行为**：
- ⚠️ 明确告知用户「无法严格回答」
- ✅ 仍返回最佳努力的回答，但标记为低置信度
- ✅ 显示推理过程（检索了几轮、每轮检索词是什么）
- ❌ 不得伪装为成功的严格回答

**用户提示文案**：
> 严格模式已尝试多轮检索，仍未找到充分证据。以下回答仅供参考。

**设计理由**：  
严格模式承诺「更可靠的回答」，当无法兑现时必须诚实告知，而非隐藏失败。

---

## 3. 引用来源（Sources）的可信性约束

### 3.1 来源展示规则

| 场景 | 是否展示来源 |
|------|-------------|
| 检索到相关文档且相似度达标 | ✅ 展示，包含文件名、相关度分数、原文片段 |
| 检索无结果 | ❌ 不展示（没有有效来源） |
| 来源与结论相关性弱 | ⚠️ 展示但分数较低，用户可自行判断 |

### 3.2 约束规则

- **不伪造来源**：来源必须真实对应知识库中的文档片段
- **不强行附加**：推断性内容不会强行附加引用来源
- **分数透明**：每个来源的相关度分数可见，用户可判断关联强度
- **原文可查**：点击「查看原文」可查看完整文档内容

---

## 4. 删除文档与索引一致性

### 4.1 删除行为说明

| 操作 | 即时生效？ | 说明 |
|------|-----------|------|
| 删除文档 | ❌ 否 | 仅删除源文件，向量索引未更新 |
| 重新索引 | ✅ 是 | 清空并重建索引，删除的文档不再被检索 |

### 4.2 索引过期状态

当用户删除文档后、尚未重新索引时：
- 系统会提示「请重新索引以更新知识库」
- 此时检索结果可能包含已删除文档的内容（幽灵文档）
- 建议用户在删除文档后尽快执行重新索引

### 4.3 设计理由

删除操作与索引更新分离，是为了避免误删除导致不可恢复。用户可在重新索引前确认删除是否正确。

---

## 5. 文档导出（保存为文档）的安全约束

### 5.1 导出条件

| 条件 | 是否允许导出 |
|------|-------------|
| 知识库为空 | ❌ 禁止 |
| 检索无结果 | ⚠️ 允许，但文档中标注「未找到引用来源」 |
| 严格模式失败 | ⚠️ 允许，但文档中标注置信度为「低」 |
| 正常回答 | ✅ 允许 |

### 5.2 文档内容

导出的 Markdown 文档包含：
- 原始问题
- 完整回答
- 置信度评估（高/中/低）
- 引用来源列表（如有）
- 生成时间与模式信息

### 5.3 设计理由

防止将不可靠内容固化为「正式成果」。导出文档始终保留置信度和来源信息，供后续审核判断。

---

## 6. 系统不保证的能力（明确边界）

为避免误解，以下是系统**不承诺**的能力：

| 不保证的能力 | 说明 |
|-------------|------|
| 覆盖所有问题 | 系统仅能回答与知识库内容相关的问题 |
| 知识库外问题的准确性 | 超出知识库范围的问题，回答不具备可靠性 |
| 实时信息 | 知识库内容为静态导入，不具备联网更新能力 |
| 人工审核替代 | 系统回答不等同于专业人工审核或权威判断 |
| 100% 准确率 | AI 系统存在固有局限，可能产生错误 |
| 法律/医疗等专业建议 | 系统不提供专业领域的决策建议 |

---

## 7. 面向用户的透明性说明

系统通过以下方式确保用户始终了解回答的可信程度：

### 7.1 状态指示器

| 指示器 | 位置 | 含义 |
|--------|------|------|
| 状态标签 | 顶部栏 | 显示「知识库就绪」或「知识库为空」 |
| 文本块数量 | 顶部栏 | 显示当前索引的文本块数量 |
| 严格模式标签 | 顶部栏 | 启用时显示「严格模式」标识 |

### 7.2 回答级别提示

| 提示 | 含义 |
|------|------|
| 置信度标签（高/中/低） | 每条回答右上角显示，反映证据充分程度 |
| 来源数量 | 「证据：X 条」明确告知引用依据数量 |
| 证据声明 | 「以下内容来自你的知识库，而非模型臆测」 |
| 低置信度警告 | 证据不足时显示建议补充文档的提示卡 |

### 7.3 操作级别提示

| 操作 | 提示 |
|------|------|
| 空知识库时提问 | 输入框显示警告，阻止提交 |
| 删除文档后 | 提示「请重新索引以更新知识库」 |
| 严格模式启用 | 显示「严格模式将在资料不足时自动补充检索...」 |

---

## 8. 总结

知识库助手的核心设计理念是：**在用户信任系统的同时，让系统诚实地暴露自己的局限**。

- 当系统有把握时，提供有据可查的回答
- 当系统不确定时，明确标注不确定性
- 当系统无法回答时，主动拒绝而非胡编

这种设计不是为了限制系统能力，而是为了建立真正可持续的用户信任。

---

*文档版本：v2.1*  
*最后更新：2026-01-15*

