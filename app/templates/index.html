<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>知识库助手 v2.0 - AI 知识工作台</title>
    <meta name="description" content="一个基于私有文档的智能问答与分析工作台，支持证据引用与自动再检索。">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Noto+Sans+SC:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            /* 企业级暗色主题 */
            --bg-primary: #09090b;
            --bg-secondary: #18181b;
            --bg-tertiary: #27272a;
            --bg-card: #1c1c1f;
            --bg-elevated: #222225;
            --bg-hover: #2a2a2d;
            
            --border-subtle: rgba(255, 255, 255, 0.06);
            --border-default: rgba(255, 255, 255, 0.1);
            --border-strong: rgba(255, 255, 255, 0.15);
            
            --accent-primary: #0ea5e9;
            --accent-hover: #38bdf8;
            --accent-subtle: rgba(14, 165, 233, 0.12);
            --accent-muted: rgba(14, 165, 233, 0.08);
            
            --color-success: #22c55e;
            --color-warning: #f59e0b;
            --color-error: #ef4444;
            --color-info: #6366f1;
            --color-agentic: #a855f7;
            
            --text-primary: #fafafa;
            --text-secondary: #a1a1aa;
            --text-muted: #71717a;
            --text-disabled: #52525b;
        }
        
        * { box-sizing: border-box; }
        
        body {
            font-family: 'Noto Sans SC', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow: hidden;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
        }
        
        /* 状态 Pill */
        .status-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 9999px;
            font-size: 12px;
            font-weight: 500;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-subtle);
        }
        
        .status-pill .dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }
        
        .status-pill.ready .dot { background: var(--color-success); box-shadow: 0 0 8px rgba(34, 197, 94, 0.5); }
        .status-pill.pending .dot { background: var(--color-warning); animation: pulse 2s infinite; }
        .status-pill.error .dot { background: var(--color-error); }
        .status-pill.agentic { 
            background: rgba(168, 85, 247, 0.1); 
            border-color: rgba(168, 85, 247, 0.3);
            color: var(--color-agentic);
        }
        .status-pill.agentic .dot { background: var(--color-agentic); }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* 置信度标签 */
        .confidence-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .confidence-high {
            background: rgba(34, 197, 94, 0.12);
            color: var(--color-success);
            border: 1px solid rgba(34, 197, 94, 0.2);
        }
        
        .confidence-medium {
            background: rgba(245, 158, 11, 0.12);
            color: var(--color-warning);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }
        
        .confidence-low {
            background: rgba(239, 68, 68, 0.12);
            color: var(--color-error);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }
        
        /* 能力标签 */
        .capability-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 500;
            background: var(--bg-tertiary);
            color: var(--text-muted);
            border: 1px solid var(--border-subtle);
        }
        
        .capability-tag.highlight {
            background: var(--accent-subtle);
            color: var(--accent-primary);
            border-color: rgba(14, 165, 233, 0.2);
        }
        
        /* 按钮 */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.15s ease;
            cursor: pointer;
            border: none;
            outline: none;
        }
        
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .btn-primary {
            background: var(--accent-primary);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) { background: var(--accent-hover); }
        
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid var(--border-default);
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: var(--bg-hover);
            color: var(--text-primary);
        }
        
        .btn-ghost {
            background: transparent;
            color: var(--text-secondary);
        }
        
        .btn-ghost:hover:not(:disabled) {
            background: var(--bg-hover);
            color: var(--text-primary);
        }
        
        .btn-danger {
            background: rgba(239, 68, 68, 0.15);
            color: var(--color-error);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }
        
        .btn-danger:hover:not(:disabled) {
            background: var(--color-error);
            color: white;
        }
        
        /* 输入框 */
        .input {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            padding: 8px 12px;
            color: var(--text-primary);
            font-size: 13px;
            transition: all 0.15s ease;
            width: 100%;
        }
        
        .input::placeholder { color: var(--text-muted); }
        
        .input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 2px var(--accent-muted);
        }
        
        /* 复选框 */
        .checkbox-wrapper {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            user-select: none;
        }
        
        .checkbox {
            appearance: none;
            width: 16px;
            height: 16px;
            border: 1.5px solid var(--border-strong);
            border-radius: 4px;
            background: var(--bg-secondary);
            cursor: pointer;
            transition: all 0.15s ease;
            position: relative;
        }
        
        .checkbox:checked {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }
        
        .checkbox:checked::after {
            content: '';
            position: absolute;
            left: 4.5px;
            top: 1.5px;
            width: 4px;
            height: 8px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }
        
        .checkbox.agentic:checked {
            background: var(--color-agentic);
            border-color: var(--color-agentic);
        }
        
        /* 滚动条 */
        .scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .scrollbar::-webkit-scrollbar-track { background: transparent; }
        .scrollbar::-webkit-scrollbar-thumb { background: var(--border-default); border-radius: 3px; }
        .scrollbar::-webkit-scrollbar-thumb:hover { background: var(--border-strong); }
        
        /* 消息气泡 */
        .message { animation: slideIn 0.25s ease; }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message-user {
            background: var(--accent-primary);
            border-radius: 16px 16px 4px 16px;
        }
        
        .message-assistant {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px 16px 16px 4px;
        }
        
        /* Toast */
        .toast {
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            animation: toastIn 0.25s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        @keyframes toastIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .toast-success { background: var(--color-success); color: white; }
        .toast-error { background: var(--color-error); color: white; }
        .toast-warning { background: var(--color-warning); color: #18181b; }
        .toast-info { background: var(--color-info); color: white; }
        
        /* 来源卡片 */
        .source-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            padding: 12px;
            transition: all 0.15s ease;
        }
        
        .source-card:hover {
            border-color: var(--border-default);
            background: var(--bg-tertiary);
        }
        
        /* 文件项 */
        .file-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        
        .file-item:hover { background: var(--bg-hover); }
        
        /* 拖拽区 */
        .dropzone {
            border: 1.5px dashed var(--border-default);
            border-radius: 10px;
            padding: 24px;
            text-align: center;
            transition: all 0.15s ease;
            cursor: pointer;
        }
        
        .dropzone:hover,
        .dropzone.dragover {
            border-color: var(--accent-primary);
            background: var(--accent-muted);
        }
        
        /* 流式光标 */
        .streaming::after {
            content: '▌';
            animation: blink 0.8s infinite;
            color: var(--accent-primary);
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        /* 加载动画 */
        .loading-dots {
            display: flex;
            gap: 4px;
        }
        
        .loading-dots span {
            width: 6px;
            height: 6px;
            background: var(--accent-primary);
            border-radius: 50%;
            animation: bounce 1.4s ease-in-out infinite;
        }
        
        .loading-dots span:nth-child(2) { animation-delay: 0.16s; }
        .loading-dots span:nth-child(3) { animation-delay: 0.32s; }
        
        @keyframes bounce {
            0%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-6px); }
        }
        
        /* Markdown 内容 */
        .prose h1, .prose h2, .prose h3 {
            font-weight: 600;
            margin: 0.75em 0 0.5em;
            color: var(--text-primary);
        }
        .prose h1 { font-size: 1.25em; }
        .prose h2 { font-size: 1.125em; }
        .prose h3 { font-size: 1em; }
        .prose p { margin: 0.5em 0; }
        .prose ul, .prose ol { margin: 0.5em 0; padding-left: 1.25em; }
        .prose li { margin: 0.25em 0; color: var(--text-secondary); }
        .prose code {
            background: var(--accent-subtle);
            color: var(--accent-primary);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875em;
        }
        .prose pre {
            background: var(--bg-secondary);
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 0.75em 0;
            border: 1px solid var(--border-subtle);
        }
        .prose pre code { background: none; padding: 0; color: var(--text-secondary); }
        .prose strong { color: var(--text-primary); font-weight: 600; }
        
        /* 推理轨迹 */
        .reasoning-trace {
            background: rgba(168, 85, 247, 0.06);
            border: 1px solid rgba(168, 85, 247, 0.15);
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
        }
        
        .reasoning-step {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 0;
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .reasoning-step .icon {
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 10px;
        }
        
        /* 低置信度提示 */
        .low-confidence-alert {
            background: rgba(239, 68, 68, 0.08);
            border: 1px solid rgba(239, 68, 68, 0.2);
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
        }
        
        /* 预览抽屉 */
        .drawer {
            position: fixed;
            top: 0;
            right: 0;
            height: 100vh;
            width: 45%;
            max-width: 600px;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-subtle);
            transform: translateX(100%);
            transition: transform 0.25s ease;
            z-index: 100;
            display: flex;
            flex-direction: column;
        }
        
        .drawer.open { transform: translateX(0); }
        
        .drawer-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            opacity: 0;
            visibility: hidden;
            transition: all 0.25s ease;
            z-index: 99;
        }
        
        .drawer-overlay.open { opacity: 1; visibility: visible; }
        
        /* 推荐示例卡片 */
        .example-card {
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.15s ease;
            text-align: left;
        }
        
        .example-card:hover {
            background: var(--accent-subtle);
            border-color: var(--accent-primary);
        }
        
        .example-card.highlight {
            border-color: rgba(168, 85, 247, 0.3);
        }
        
        .example-card.highlight:hover {
            border-color: var(--color-agentic);
            background: rgba(168, 85, 247, 0.08);
        }
        
        /* 证据声明 */
        .evidence-disclaimer {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: rgba(34, 197, 94, 0.06);
            border: 1px solid rgba(34, 197, 94, 0.15);
            border-radius: 6px;
            font-size: 11px;
            color: var(--color-success);
        }
        
        /* Agentic 提示横幅 */
        .agentic-warning {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(168, 85, 247, 0.08);
            border: 1px solid rgba(168, 85, 247, 0.2);
            border-radius: 8px;
            font-size: 12px;
            color: var(--color-agentic);
            margin-bottom: 12px;
        }
        
        /* 高亮 */
        .highlight { background: rgba(245, 158, 11, 0.25); padding: 0 2px; border-radius: 2px; }
        
        /* 侧边栏收起/展开 */
        .sidebar-collapsed {
            width: 0 !important;
            min-width: 0 !important;
            overflow: hidden;
            padding: 0 !important;
            border: none !important;
        }
        
        .sidebar-toggle {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 20;
            width: 20px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-subtle);
            cursor: pointer;
            transition: all 0.15s ease;
        }
        
        .sidebar-toggle:hover {
            background: var(--bg-hover);
            border-color: var(--accent-primary);
        }
        
        .sidebar-toggle.collapsed {
            left: 0;
            border-radius: 0 6px 6px 0;
            border-left: none;
        }
        
        .sidebar-toggle.expanded {
            left: 287px;
            border-radius: 0 6px 6px 0;
            border-left: none;
        }
        
        .sidebar-toggle svg {
            transition: transform 0.2s ease;
        }
        
        .sidebar-toggle.collapsed svg {
            transform: rotate(0deg);
        }
        
        .sidebar-toggle.expanded svg {
            transform: rotate(180deg);
        }
        
        /* 文件项删除按钮 */
        .file-item .delete-btn {
            opacity: 0;
            transition: opacity 0.15s ease;
        }
        
        .file-item:hover .delete-btn {
            opacity: 1;
        }
        
        .delete-btn:hover {
            color: var(--color-error) !important;
        }
        
        /* 禁用状态 */
        .disabled-overlay {
            position: relative;
        }
        
        .disabled-overlay::after {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.3);
            cursor: not-allowed;
            z-index: 10;
        }
        
        .input:disabled, .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <!-- Toast 容器 -->
    <div id="toast-container" class="fixed bottom-6 right-6 z-50 space-y-3"></div>
    
    <!-- 重新索引确认弹窗 -->
    <div id="confirm-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/60" onclick="closeConfirmModal()"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-md">
            <div class="card p-6" style="background: var(--bg-secondary);">
                <div class="flex items-start gap-4 mb-4">
                    <div class="w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0" style="background: rgba(245, 158, 11, 0.15);">
                        <svg class="w-5 h-5" style="color: var(--color-warning);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                        </svg>
                    </div>
                    <div class="flex-1">
                        <h3 id="confirm-title" class="text-base font-semibold mb-2">确认重新索引？</h3>
                        <p id="confirm-message" class="text-sm" style="color: var(--text-muted);">
                            该操作将清空并重新构建当前知识库的向量索引。所有文档将按最新规则重新处理，可能需要一定时间。
                        </p>
                    </div>
                </div>
                <div class="flex justify-end gap-3">
                    <button onclick="closeConfirmModal()" class="btn btn-secondary">取消</button>
                    <button id="confirm-action-btn" onclick="confirmReindex()" class="btn btn-danger">确认重新索引</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 删除文档确认弹窗 -->
    <div id="delete-confirm-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/60" onclick="closeDeleteModal()"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-md">
            <div class="card p-6" style="background: var(--bg-secondary);">
                <div class="flex items-start gap-4 mb-4">
                    <div class="w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0" style="background: rgba(239, 68, 68, 0.15);">
                        <svg class="w-5 h-5" style="color: var(--color-error);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                        </svg>
                    </div>
                    <div class="flex-1">
                        <h3 id="delete-confirm-title" class="text-base font-semibold mb-2">确认删除文档？</h3>
                        <p id="delete-confirm-message" class="text-sm" style="color: var(--text-muted);">
                            该操作将永久删除此文档，删除后不可恢复。删除完成后需要重新索引以更新知识库。
                        </p>
                    </div>
                </div>
                <div class="flex justify-end gap-3">
                    <button onclick="closeDeleteModal()" class="btn btn-secondary">取消</button>
                    <button id="delete-action-btn" onclick="confirmDeleteFile()" class="btn btn-danger">确认删除</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 全局索引状态栏 -->
    <div id="indexing-status" class="fixed top-0 left-0 right-0 z-40 hidden">
        <div class="flex items-center justify-center gap-3 py-2 px-4" style="background: rgba(14, 165, 233, 0.15); border-bottom: 1px solid rgba(14, 165, 233, 0.3);">
            <svg class="w-4 h-4 animate-spin" style="color: var(--accent-primary);" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span class="text-sm font-medium" style="color: var(--accent-primary);">正在重新构建知识库索引…</span>
        </div>
    </div>
    
    <!-- 预览遮罩 -->
    <div id="preview-overlay" class="drawer-overlay" onclick="closePreview()"></div>
    
    <!-- 文档预览抽屉 -->
    <div id="preview-drawer" class="drawer">
        <div class="p-4 border-b border-white/5 flex items-center justify-between">
            <div>
                <h3 class="font-medium text-sm">文档预览</h3>
                <p id="preview-filename" class="text-xs text-zinc-500 font-mono mt-1"></p>
            </div>
            <button onclick="closePreview()" class="btn btn-ghost p-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <div id="preview-content" class="flex-1 overflow-y-auto scrollbar p-4">
            <pre class="text-sm text-zinc-400 whitespace-pre-wrap leading-relaxed font-mono"></pre>
        </div>
    </div>
    
    <div class="flex flex-col h-screen">
    <!-- 顶部栏 -->
        <header class="flex items-center justify-between px-5 py-3 border-b" style="border-color: var(--border-subtle); background: var(--bg-secondary);">
            <!-- 左侧：品牌 + 定位 -->
            <div class="flex items-center gap-3">
                <div class="w-9 h-9 rounded-lg flex items-center justify-center" style="background: var(--accent-subtle);">
                    <svg class="w-5 h-5" style="color: var(--accent-primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                </div>
                <div>
                    <h1 class="text-sm font-semibold">知识库助手 <span class="font-normal" style="color: var(--text-muted);">v2.0</span></h1>
                    <p class="text-xs" style="color: var(--text-muted);">AI 知识工作台 · Agentic RAG</p>
                </div>
            </div>
            
            <!-- 中间：状态 Pills + 能力标签 -->
                <div class="flex items-center gap-2">
                <div id="status-pill" class="status-pill pending">
                    <span class="dot"></span>
                    <span id="status-text">检查服务状态...</span>
                </div>
                <div id="chunk-pill" class="status-pill hidden">
                    <span id="chunk-count">0</span> 文本块
                </div>
                <div id="agentic-pill" class="status-pill agentic hidden">
                    <span class="dot"></span>
                    Agentic
                </div>
                <div id="langsmith-pill" class="status-pill hidden">
                    <span class="dot" style="background: var(--color-info);"></span>
                    Tracing
                </div>
                <!-- 能力标签 -->
                <div class="flex items-center gap-1 ml-2">
                    <span class="capability-tag highlight">证据可追溯</span>
                    <span class="capability-tag">多轮检索</span>
                </div>
                </div>
                
            <!-- 右侧：会话配置 -->
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-2">
                    <span class="text-xs" style="color: var(--text-muted);">用户</span>
                    <input id="user-id" type="text" value="user_001" class="input font-mono" style="width: 100px; padding: 4px 8px; font-size: 12px;">
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-xs" style="color: var(--text-muted);">会话</span>
                    <input id="thread-id" type="text" value="thread_001" class="input font-mono" style="width: 100px; padding: 4px 8px; font-size: 12px;">
            </div>
        </div>
    </header>
    
    <!-- 主内容区 -->
        <main class="flex flex-1 min-h-0 relative">
            <!-- 侧边栏切换按钮 -->
            <button id="sidebar-toggle" class="sidebar-toggle expanded" title="收起侧边栏，专注查看回答内容" onclick="toggleSidebar()">
                <svg class="w-3 h-3" style="color: var(--text-muted);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
            </button>
            
            <!-- 左侧：AI 工作台 -->
            <aside id="sidebar" class="w-72 flex flex-col border-r transition-all duration-300" style="border-color: var(--border-subtle); background: var(--bg-secondary);">
            <!-- 上传区域 -->
                <div class="p-4 border-b" style="border-color: var(--border-subtle);">
                    <div class="flex items-center justify-between mb-3">
                        <h2 class="text-xs font-medium" style="color: var(--text-secondary);">添加文档</h2>
                    </div>
                    
                    <div id="dropzone" class="dropzone mb-3">
                        <input type="file" id="file-input" multiple accept=".md,.txt" class="hidden">
                        <div class="w-10 h-10 mx-auto mb-2 rounded-lg flex items-center justify-center" style="background: var(--bg-tertiary);">
                            <svg class="w-5 h-5" style="color: var(--text-muted);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                    </svg>
                        </div>
                        <p class="text-xs" style="color: var(--text-muted);">拖拽文件至此或点击选择</p>
                        <p class="text-xs mt-1 font-mono" style="color: var(--text-disabled);">.md .txt</p>
                </div>
                
                    <div id="selected-files" class="hidden mb-3 p-2 rounded-lg" style="background: var(--bg-tertiary);">
                        <p class="text-xs mb-2" style="color: var(--text-muted);">已选择：</p>
                        <div id="selected-files-list" class="space-y-1 text-xs" style="color: var(--accent-primary);"></div>
                </div>
                
                    <button id="upload-btn" class="btn btn-primary w-full">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                        </svg>
                    上传并入库
                </button>
            </div>
            
                <!-- 知识库文件 -->
            <div class="flex-1 flex flex-col min-h-0">
                    <div class="px-4 py-3 flex items-center justify-between border-b" style="border-color: var(--border-subtle);">
                        <h2 class="text-xs font-medium" style="color: var(--text-secondary);">知识库</h2>
                        <span id="file-count" class="text-xs font-mono px-2 py-0.5 rounded" style="background: var(--bg-tertiary); color: var(--text-muted);">0 个文件</span>
                    </div>
                    
                    <div id="file-list" class="flex-1 overflow-y-auto scrollbar p-2">
                        <div id="files-empty" class="text-center py-8">
                            <div class="w-10 h-10 mx-auto mb-3 rounded-lg flex items-center justify-center" style="background: var(--bg-tertiary);">
                                <svg class="w-5 h-5" style="color: var(--text-disabled);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
                        </svg>
                            </div>
                            <p class="text-xs" style="color: var(--text-muted);">上传文档以构建知识库</p>
                </div>
                </div>
            </div>
            
                <!-- 底部操作 -->
                <div class="p-3 border-t" style="border-color: var(--border-subtle);">
                    <button id="ingest-btn" class="btn btn-secondary w-full text-xs" 
                            title="重新构建整个知识库索引。当文档内容或索引配置发生变化时使用。">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                        重新索引
                </button>
            </div>
        </aside>
        
            <!-- 右侧：智能工作区 -->
            <section class="flex-1 flex flex-col min-w-0" style="background: var(--bg-primary);">
                <!-- 消息区域 -->
                <div id="chat-messages" class="flex-1 overflow-y-auto scrollbar p-6 space-y-4">
                    <!-- 欢迎状态 + 推荐示例 -->
                    <div id="welcome-state" class="max-w-2xl mx-auto py-8">
                        <!-- 品牌介绍 -->
                        <div class="text-center mb-8">
                            <div class="w-16 h-16 mx-auto mb-4 rounded-2xl flex items-center justify-center" style="background: var(--accent-subtle);">
                                <svg class="w-8 h-8" style="color: var(--accent-primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                                </svg>
                            </div>
                            <h2 class="text-xl font-semibold mb-2">知识库助手 v2.0</h2>
                            <p class="text-sm mb-4" style="color: var(--text-secondary);">
                                一个基于私有文档的智能问答与分析工作台，<br>支持<span style="color: var(--color-success);">证据引用</span>与<span style="color: var(--color-agentic);">自动再检索</span>。
                            </p>
                            <div class="flex items-center justify-center gap-2">
                                <span class="capability-tag highlight">Agentic RAG</span>
                                <span class="capability-tag highlight">证据可追溯</span>
                                <span class="capability-tag">多轮检索</span>
                            </div>
                        </div>
                        
                        <!-- 推荐示例 -->
                        <div class="mb-6">
                            <h3 class="text-xs font-medium mb-3 flex items-center gap-2" style="color: var(--text-muted);">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                </svg>
                                推荐示例 · 点击快速体验核心能力
                            </h3>
                            <div class="space-y-3">
                                <!-- 示例 1：理解系统 -->
                                <div class="example-card" onclick="useExample('请介绍这个系统的主要功能，并说明每个功能的使用场景。', false)">
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="text-xs font-medium" style="color: var(--accent-primary);">理解系统</span>
                                        <span class="capability-tag" style="font-size: 9px;">基础能力</span>
                                    </div>
                                    <p class="text-sm" style="color: var(--text-secondary);">请介绍这个系统的主要功能，并说明每个功能的使用场景。</p>
                                </div>
                                
                                <!-- 示例 2：严谨问答 -->
                                <div class="example-card" onclick="useExample('根据知识库内容，总结核心要点，并给出引用来源。', false)">
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="text-xs font-medium" style="color: var(--color-success);">严谨问答</span>
                                        <span class="capability-tag" style="font-size: 9px;">证据引用</span>
                                    </div>
                                    <p class="text-sm" style="color: var(--text-secondary);">根据知识库内容，总结核心要点，并给出引用来源。</p>
                                </div>
                                
                                <!-- 示例 3：Agentic 能力 -->
                                <div class="example-card highlight" onclick="useExample('如果资料不足，请自动补充检索并给出更严格的回答。', true)">
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="text-xs font-medium" style="color: var(--color-agentic);">Agentic 能力</span>
                                        <span class="status-pill agentic" style="font-size: 9px; padding: 1px 6px;">
                                            <span class="dot" style="width: 4px; height: 4px;"></span>
                                            自动再检索
                                        </span>
                                    </div>
                                    <p class="text-sm" style="color: var(--text-secondary);">如果资料不足，请自动补充检索并给出更严格的回答。</p>
                                </div>
                            </div>
                    </div>
                </div>
            </div>
            
            <!-- 输入区域 -->
                <div class="p-4 border-t" style="border-color: var(--border-subtle); background: var(--bg-secondary);">
                    <div class="max-w-3xl mx-auto">
                        <!-- 空知识库警告（默认隐藏） -->
                        <div id="empty-kb-warning" class="hidden mb-3 p-3 rounded-lg" style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.2);">
                            <div class="flex items-center gap-2">
                                <svg class="w-4 h-4 flex-shrink-0" style="color: var(--color-error);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                                </svg>
                                <span class="text-xs" style="color: var(--color-error);">当前知识库为空，无法基于文档回答问题。请先上传并索引文档。</span>
                            </div>
                        </div>
                        
                        <!-- 严格模式提示（默认隐藏） -->
                        <div id="agentic-warning" class="agentic-warning hidden">
                            <svg class="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <span>严格模式将在资料不足时自动补充检索并校验回答，结果更可靠但可能稍慢。</span>
                        </div>
                        
                    <!-- 选项栏 -->
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-4">
                                <label class="checkbox-wrapper text-xs" style="color: var(--text-muted);">
                                    <input type="checkbox" id="save-to-file" class="checkbox">
                                    <span>保存为文档</span>
                                </label>
                                <input type="text" id="file-name" placeholder="文件名（可选）" class="input font-mono hidden" style="width: 150px; padding: 4px 8px; font-size: 12px;">
                            </div>
                            
                            <div class="flex items-center gap-4">
                                <label class="checkbox-wrapper text-xs" style="color: var(--text-muted);" title="当资料不足时会自动补充检索并校验回答，结果更可靠但可能稍慢">
                                    <input type="checkbox" id="use-agentic" class="checkbox agentic">
                                    <span style="color: var(--color-agentic);">严格模式</span>
                                </label>
                                <label class="checkbox-wrapper text-xs" style="color: var(--text-muted);" title="回答会实时显示，无需等待完整结果">
                                    <input type="checkbox" id="use-stream" class="checkbox" checked>
                                    <span>实时回答</span>
                        </label>
                            </div>
                    </div>
                    
                        <!-- 输入框 -->
                    <div class="flex gap-3">
                            <div class="flex-1 relative">
                        <textarea id="message-input" 
                            rows="1"
                                    class="input w-full resize-none pr-4"
                                    style="min-height: 44px; max-height: 120px;"
                                    placeholder="输入您的问题，我将基于知识库为您解答..."></textarea>
                            </div>
                            <button id="send-btn" class="btn btn-primary self-end">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                            </svg>
                            发送
                        </button>
                            <button id="stop-btn" class="btn btn-danger self-end hidden">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"/>
                                </svg>
                                停止
                        </button>
                    </div>
                        
                        <p class="text-xs mt-2 text-center" style="color: var(--text-disabled);">
                            <kbd class="px-1.5 py-0.5 rounded text-xs font-mono" style="background: var(--bg-tertiary);">Enter</kbd> 发送，
                            <kbd class="px-1.5 py-0.5 rounded text-xs font-mono" style="background: var(--bg-tertiary);">Shift + Enter</kbd> 换行
                        </p>
                </div>
            </div>
        </section>
    </main>
    </div>
    
    <script src="/static/ui_texts.js"></script>
    <script src="/static/app.js"></script>
</body>
</html>
